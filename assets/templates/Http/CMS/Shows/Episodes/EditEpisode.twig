{# @var \App\Context\Shows\Models\ShowModel show #}
{# @var mixed[] statusOptions #}
{# @var mixed[] typeOptions #}
{# @var mixed[] peopleOptions #}
{# @var mixed[] seriesOptions #}

{% extends 'Http/_Infrastructure/_LayoutCms.twig' %}

{% block cmsPreContent %}
    {% if deleteAction is defined %}
        <form
            method="post"
            action="{{ deleteAction }}"
            class="block mb-5"
            ref="ConfirmSubmit"
            data-submit-action-text="Delete {{ episode.title }}"
        >
            <input type="hidden" name="{!--csrfTokenNameKey--}" value="{!--csrfTokenName--}">
            <input type="hidden" name="{!--csrfTokenValueKey--}" value="{!--csrfTokenValue--}">
            <button
                type="submit"
                class="inline-flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-red-700 hover:bg-red-500 focus:outline-none focus:bg-red-800 focus:shadow-outline-indigo active:bg-red-700 transition duration-150 ease-in-out"
            >
                Delete {{ episode.title }}&hellip;
            </button>
        </form>
    {% endif %}
{% endblock %}

{% set explicit = show.explicit ? 'true' : 'false' %}

{% if episode is defined %}
    {% set explicit = episode.explicit ? 'true' : 'false' %}
{% endif %}

{% set hosts = [] %}

{% if episode is defined %}
    {% for host in episode.hosts %}
        {% set hosts = hosts|merge([host.id]) %}
    {% endfor %}
{% else %}
    {% for host in show.hosts %}
        {% set hosts = hosts|merge([host.id]) %}
    {% endfor %}
{% endif %}

{% set guests = [] %}

{% if episode is defined %}
    {% for guest in episode.guests %}
        {% set guests = guests|merge([guest.id]) %}
    {% endfor %}
{% endif %}

{% set series = [] %}

{% if episode is defined %}
    {% for item in episode.series %}
        {% set series = series|merge([item.id]) %}
    {% endfor %}
{% endif %}

{% block cmsContent %}
    {% include 'Http/CMS/_Infrastructure/Forms/_LabelsOnLeftForm.twig' with {
        submitContent: episode is defined ? 'Save' : 'Create',
        cancelAction: '/cms/shows/episodes/' ~ show.id,
        inputs: [
            {
                label: 'Title',
                name: 'title',
                value: episode.title ?? '',
            },
            {
                label: 'Status',
                name: 'status',
                type: 'radio',
                options: statusOptions,
                value: episode.status ?? '',
            },
            {
                label: 'Description',
                name: 'description',
                type: 'textarea',
                value: episode.description ?? '',
            },
            {
                label: 'Playable Episode File',
                name: 'file',
                type: 'file_upload',
                value: episode.fileName ?? '',
            },
            {
                label: 'Episode Type',
                name: 'type',
                type: 'radio',
                options: typeOptions,
                value: episode.type ?? '',
            },
            {
                label: 'Explicit?',
                name: 'explicit',
                type: 'lightswitch',
                value: explicit,
            },
            {
                label: 'Show Notes',
                name: 'show_notes',
                type: 'markdown',
                value: episode.showNotes ?? '',
            },
            {
                label: 'Hosts',
                name: 'hosts',
                type: 'select',
                multiple: true,
                options: peopleOptions,
                value: hosts,
            },
            {
                label: 'Guests',
                name: 'guests',
                type: 'select',
                multiple: true,
                options: peopleOptions,
                value: guests,
            },
            {
                label: 'Keywords',
                subLabel: "Comma seperated list. Keywords will be normalized without capitalization.",
                name: 'keywords',
                type: 'textarea',
                value: keywords ?? '',
            },
            {
                label: 'Series',
                name: 'series',
                type: 'select',
                multiple: true,
                options: seriesOptions,
                value: series,
            },
            {
                label: 'Publish At',
                subLabel: "Leave blank to publish right away. Timezone is your user account preferences timezone.",
                name: 'publish_at',
                type: 'datetime-local',
                value: episode.publishAt.format('Y-m-d g:i A') ?? '',
            },
        ],
    } only %}
{% endblock %}

